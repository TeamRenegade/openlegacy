<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:drools="http://drools.org/schema/drools-spring"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://drools.org/schema/drools-spring http://drools.org/schema/drools-spring.xsd">

	<import resource="classpath:/META-INF/default-actions-context.xml" />
	 
	<context:component-scan base-package="org.openlegacy.designtime">
        <context:exclude-filter expression=".*mock.*" type="regex"/>
	</context:component-scan>
	
	<bean class="org.openlegacy.designtime.terminal.analyzer.support.DefaultTerminalSnapshotsOrganizer" p:matchingPercent="93" />

	<bean id="screenEntityDefinitionsBuilder" class="org.openlegacy.designtime.terminal.analyzer.support.DefaultScreenEntityDefinitionsBuilder">
		<property name="screenFactProcessors">
			<list>
				<bean class="org.openlegacy.designtime.terminal.analyzer.support.fact_processors.ScreenWindowFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.support.fact_processors.ScreenIdentifiersFactProcessor" p:maxIdentifiers="3"/>
				<bean class="org.openlegacy.designtime.terminal.analyzer.support.fact_processors.ScreenActionFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.modules.table.ScreenTableFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.modules.login.LoginScreenFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.modules.menu.MenuScreenFactProcessor"/>
				<bean class="org.openlegacy.designtime.terminal.analyzer.modules.navigation.NavigationFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.support.fact_processors.BooleanFieldFactProcessor" />
				<bean class="org.openlegacy.designtime.terminal.analyzer.support.fact_processors.FieldValuesFactProcessor" />
			</list>
		</property>
	</bean>
	
	<bean class="org.openlegacy.support.SimpleFieldFormatter" />

	<bean id="terminalActionAnalyzer" class="org.openlegacy.designtime.terminal.analyzer.support.DefaultTerminalActionAnalyzer" />
	<bean id="bestEntityNameFieldComparator" class="org.openlegacy.designtime.terminal.analyzer.support.DefaultBestEntityNameFieldComparator" />

	<bean id="ruleDefinition" class="org.openlegacy.designtime.rules.support.RuleDefinitionBean" abstract="true"/>
	<bean id="ruleParametersSet" class="org.openlegacy.designtime.rules.support.RuleParametersSetBean" abstract="true"/>
	 
	<bean class="org.openlegacy.designtime.terminal.analyzer.support.DefaultTerminalSnapshotsAnalyzer" p:processName="screen-builder">
		<property name="ruleDefinitions">
			<list>
				<bean parent="ruleDefinition" p:droolsFile="rules/screen-builder.bpmn" />
				<bean parent="ruleDefinition" p:droolsFile="rules/package.drl" />
				<bean parent="ruleDefinition" p:droolsFile="rules/default-manage-screen-entities.drl" />
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-window.drl" p:ruleId="identify-window">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<!-- // "+" sign followed by "-" X times, and ends with "+" sign -->
										<entry key="topHorizonalBordersPattern" value="\+-+\+" />
										<entry key="buttomHorizonalBordersPattern" value="\+-+\+" />
										<entry key="verticalBorder" value="|" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-find-screen-name.drl" p:ruleId="find-screen-name">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="titleRegex" value="\s*\w+[\w ]*" />
										<entry key="titleStartRow" value="1" />
										<entry key="titleEndRow" value="3" />
										<entry key="titleStartColumn" value="15" />
										<entry key="titleEndColumn" value="65" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-editable-fields.drl" p:ruleId="identify-editable-fields">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="labelRegex" value="(\w|\. \.)+.*" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-menu.drl" p:ruleId="identify-menu">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="menuOptionRegex" value="\s*\d+\.\w*" />
										<entry key="maxDistance" value="4" />
										<entry key="minimumMenuItems" value="2" />
										<entry key="maxSelectionFieldLength" value="2" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-login.drl" p:ruleId="identify-login">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="userFieldRegex" value="\s*(?i)user.*" />
										<entry key="passwordFieldRegex" value="\s*(?i)password.*" />
										<entry key="errorMessageLinesFromButtom" value="0" />
										<entry key="errorMessageColumn" value="2" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-tables.drl" p:ruleId="identify-tables">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<!-- don't identify column which are in the format of: "Field A....:" which are typically leading labels -->
										<entry key="notAcolumnRegex" value="([\w ]+[\.:])+" />
										<entry key="minimumTableRows" value="3" />
										<!-- When identifying columns, at least one of the fields should contains alphanumeric chars -->
										<entry key="atLeastOneFieldShouldBe" value="\w+.*" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-readonly-fields.drl" p:ruleId="identify-readonly-fields">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="fieldRegex" value="[ ]*\w+[\w/ ]*" />
										<entry key="labelRegex" value="\w+.*[\.:].*" />
										<entry key="maxDistance" value="7" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-actions.drl" p:ruleId="identify-actions">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="actionsRegex" value="(\w+)[=-](\w+[\w ]*)" />
										<entry key="rowsFromEnd" value="3" />
										<entry key="actionsSplitter" value="  " />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-snapshots.drl" p:ruleId="identify-snapshots">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="identifierRegex" value="\s*[a-zA-Z]+[.: ]*.*" />
										<entry key="startRow" value="4" />
										<entry key="endRow" value="20" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-boolean.drl" p:ruleId="identify-boolean">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="trueFalseTextRegex" value="(Y\w*)/(N\w*).*" />
										<entry key="inputSize" value="1" />
										<entry key="maxDistance" value="6" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-navigation.drl" p:ruleId="identify-navigation" />
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-lookup-screens.drl" p:ruleId="identify-lookup-screens" />
			</list>
		</property>
	</bean>


	<context:annotation-config />

</beans>
