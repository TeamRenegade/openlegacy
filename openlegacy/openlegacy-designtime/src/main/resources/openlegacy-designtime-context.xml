<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:drools="http://drools.org/schema/drools-spring"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://drools.org/schema/drools-spring http://drools.org/schema/drools-spring.xsd">

	<context:component-scan base-package="org.openlegacy.designtime">
        <context:exclude-filter expression=".*mock.*" type="regex"/>
	</context:component-scan>
	
	<bean class="org.openlegacy.designtime.terminal.analyzer.support.DefaultTerminalSnapshotsSorter" p:matchingPercent="95" />

	<bean class="org.openlegacy.designtime.terminal.analyzer.support.DefaultScreenEntityDefinitionsBuilder" p:maxIdentifiers="3" />
	
	<bean class="org.openlegacy.support.SimpleFieldFormatter" />

	<bean id="ruleDefinition" class="org.openlegacy.designtime.rules.support.RuleDefinitionBean" abstract="true"/>
	<bean id="ruleParametersSet" class="org.openlegacy.designtime.rules.support.RuleParametersSetBean" abstract="true"/>
	 
	<bean class="org.openlegacy.designtime.terminal.analyzer.support.DefaultTerminalSnapshotsAnalyzer" p:processName="screen-builder">
		<property name="ruleDefinitions">
			<list>
				<bean parent="ruleDefinition" p:droolsFile="rules/screen-builder.bpmn" />
				<bean parent="ruleDefinition" p:droolsFile="rules/package.drl" />
				<bean parent="ruleDefinition" p:droolsFile="rules/default-initialize-screen-entities.drl" />
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-window.drl" p:ruleId="identify-window">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<!-- // "+" sign followed by "-" X times, and ends with "+" sign -->
										<entry key="topHorizonalBordersPattern" value="\+-+\+" />
										<entry key="buttomHorizonalBordersPattern" value="\+-+\+" />
										<entry key="verticalBorder" value="|" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-find-screen-name.drl" p:ruleId="find-screen-name">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="titleRegex" value="\s*\w+[\w ]*" />
										<entry key="titleStartRow" value="1" />
										<entry key="titleEndRow" value="3" />
										<entry key="titleStartColumn" value="20" />
										<entry key="titleEndColumn" value="60" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-editable-fields.drl" p:ruleId="identify-editable-fields">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="labelRegex" value="(\w+[\./: ]*)+" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-tables.drl" p:ruleId="identify-tables">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<!-- don't identify column which are in the format of: "Field A....:" which are typically leading labels -->
										<entry key="notAcolumnRegex" value="([\w ]+[\.:])+" />
										<entry key="minimumTableRows" value="3" />
										<!-- When identifying columns, at least one of the fields should contains alphanumeric chars -->
										<entry key="atLeastOneFieldShouldBe" value="\w+[\w ]+" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-readonly-fields.drl" p:ruleId="identify-readonly-fields">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="fieldRegex" value="\w+[\w ]*" />
										<entry key="labelRegex" value="\w+.*[\.:].*" />
										
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-actions.drl" p:ruleId="identify-actions">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="actionsRegex" value="(\w+)[=-](\w+(?:\s\w+){0,2})\s{0,1}" />
										<entry key="rowsFromEnd" value="3" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
				<bean parent="ruleDefinition" p:droolsFile="rules/default-identify-snapshots.drl" p:ruleId="identify-snapshots">
					<property name="ruleParameterSets">
						<list>
							<bean parent="ruleParametersSet">
								<property name="ruleParameters">
									<map>
										<entry key="identifierRegex" value="\s*[a-zA-Z]+[.: ]*.*" />
									</map>
								</property>
							</bean>
						</list>
					</property>
				</bean>
			</list>
		</property>
	</bean>


	<context:annotation-config />

</beans>
